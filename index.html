<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>詮威科技 - 庫存與訂單系統</title>
<style>
body { font-family: "Segoe UI", sans-serif; margin: 0; background: #f4f6f8; }
header { background: #004b87; color: white; padding: 10px 20px; font-size: 20px; }
nav { display: flex; background: #eaf0f6; }
nav button { flex: 1; padding: 10px; border: none; background: #eaf0f6; cursor: pointer; font-size: 15px; }
nav button.active { background: white; border-bottom: 3px solid #004b87; }
.page { display: none; padding: 20px; background: white; margin: 10px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.inventory-group { margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; }
.group-header { padding: 10px; background: #f9fafb; cursor: pointer; }
.group-header:hover { background: #eef5ff; }
.group-details { display: none; padding: 10px; }
.group-details table { width: 100%; border-collapse: collapse; }
.group-details th, .group-details td { padding: 6px; border-bottom: 1px solid #eee; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 6px; border-bottom: 1px solid #ccc; text-align: left; }
.total { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>
<header>詮威科技有限公司 - 庫存與訂單系統</header>
<nav>
  <button onclick="showPage('addInventory')">新增庫存</button>
  <button onclick="showPage('sellProduct')">銷售</button>
  <button onclick="showPage('searchPage')">查詢</button>
  <button onclick="showPage('inventoryList')">庫存列表</button>
  <button onclick="showPage('orderList')">訂單列表</button>
</nav>

<!-- 新增庫存 -->
<div id="addInventory" class="page">
  <h2>新增庫存</h2>
  <input id="name" placeholder="品名"><br>
  <input id="productCode" placeholder="品號"><br>
  <input id="serialNumber" placeholder="序號"><br>
  <input id="price" placeholder="原價"><br>
  <input id="discount" placeholder="折扣"><br>
  <button onclick="addInventoryItem()">新增</button>
</div>

<!-- 銷售 -->
<div id="sellProduct" class="page">
  <h2>銷售產品</h2>
  <input id="sell_productCode" placeholder="品號"><br>
  <input id="sell_serialNumber" placeholder="序號"><br>
  <input id="customerName" placeholder="客戶名稱"><br>
  <input id="customerContact" placeholder="客戶聯絡"><br>
  <input id="sellPrice" placeholder="售價"><br>
  <input id="handler" placeholder="經手人"><br>
  <input id="note" placeholder="備註"><br>
  <button onclick="sellProductItem()">銷售</button>
</div>

<!-- 查詢 -->
<div id="searchPage" class="page">
  <h2>查詢</h2>
  <input id="searchCode" placeholder="輸入品號或序號">
  <button onclick="searchCodeItem()">查詢</button>
  <div id="searchResult"></div>
</div>

<!-- 庫存列表 -->
<div id="inventoryList" class="page">
  <h2>庫存列表</h2>
  <div id="inventoryContainer"></div>
</div>

<!-- 訂單列表 -->
<div id="orderList" class="page">
  <h2>訂單列表</h2>
  <input id="orderMonth" type="month">
  <button onclick="loadOrders()">查詢</button>
  <div id="orderContainer"></div>
  <div class="total" id="orderTotal"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx_Hsx-HNKyE6Ha1Jex7DlLwXHzLionOMPTHYnSjiQqtidLTIlzbYL7TcmsNFp_zv8m/exec";

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).style.display = 'block';
  event.target.classList.add('active');
  if (id === 'inventoryList') loadInventory();
  if (id === 'orderList') loadOrders();
}

function addInventoryItem() {
  const params = new URLSearchParams({
    action: 'addInventory',
    name: name.value,
    productCode: productCode.value,
    serialNumber: serialNumber.value,
    price: price.value,
    discount: discount.value
  });
  fetch(API_URL + '?' + params).then(r => r.json()).then(d => alert(d.success ? '新增成功' : '失敗'));
}

function sellProductItem() {
  const params = new URLSearchParams({
    action: 'sellProduct',
    productCode: sell_productCode.value,
    serialNumber: sell_serialNumber.value,
    customerName: customerName.value,
    customerContact: customerContact.value,
    sellPrice: sellPrice.value,
    handler: handler.value,
    note: note.value
  });
  fetch(API_URL + '?' + params).then(r => r.json()).then(d => alert(d.success ? '銷售成功' : '失敗'));
}

function searchCodeItem() {
  fetch(API_URL + '?action=searchByCode&code=' + searchCode.value)
    .then(r => r.json()).then(data => {
      const div = document.getElementById('searchResult');
      div.innerHTML = JSON.stringify(data, null, 2);
    });
}

function loadInventory() {
  fetch(API_URL + '?action=getInventory')
    .then(r => r.json()).then(data => {
      const c = document.getElementById('inventoryContainer');
      c.innerHTML = '';
      data.forEach(g => {
        const wrap = document.createElement('div');
        wrap.className = 'inventory-group';
        const header = document.createElement('div');
        header.className = 'group-header';
        header.textContent = `${g.name}（品號:${g.productCode}）- 數量:${g.count}`;
        const detail = document.createElement('div');
        detail.className = 'group-details';
        detail.innerHTML = `<table><tr><th>序號</th><th>價格</th><th>折扣</th><th>成本</th><th>入庫日期</th></tr>
          ${g.items.map(i => `<tr><td>${i.serialNumber}</td><td>${i.price}</td><td>${i.discount}</td><td>${i.costPrice}</td><td>${i.stockInDate}</td></tr>`).join('')}</table>`;
        header.onclick = () => {
          detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
        };
        wrap.appendChild(header);
        wrap.appendChild(detail);
        c.appendChild(wrap);
      });
    });
}

function loadOrders() {
  const month = orderMonth.value || new Date().toISOString().slice(0,7);
  fetch(API_URL + '?action=getOrders&month=' + month)
    .then(r => r.json()).then(data => {
      const c = document.getElementById('orderContainer');
      c.innerHTML = `<table><tr><th>客戶</th><th>品名</th><th>品號</th><th>序號</th><th>售價</th><th>時間</th></tr>
        ${data.orders.map(o => `<tr><td>${o.customerName}</td><td>${o.name}</td><td>${o.productCode}</td><td>${o.serialNumber}</td><td>${o.sellPrice}</td><td>${o.sellTime}</td></tr>`).join('')}</table>`;
      document.getElementById('orderTotal').textContent = '總額：' + data.total;
    });
}

showPage('addInventory');
</script>
</body>
</html>
