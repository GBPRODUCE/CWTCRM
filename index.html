<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>詮威科技庫存與訂單系統</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin:0; }
  header { background-color: #003366; color: white; padding: 10px 20px; }
  h1 { margin: 0; font-size: 24px; }
  nav { display: flex; background-color: #004080; }
  nav button { flex: 1; padding: 10px; border: none; background: #004080; color: white; cursor: pointer; font-size: 16px; }
  nav button.active { background-color: #0066cc; }
  .tab-content { display: none; padding: 20px; background: white; margin: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }
  input, select, button { padding: 5px; margin: 5px 0; }
  .form-group { margin-bottom: 10px; }
</style>
</head>
<body>

<header>
  <h1>詮威科技有限公司 - 庫存與訂單系統</h1>
</header>

<nav>
  <button onclick="showTab('addInventory')" class="active">新增庫存</button>
  <button onclick="showTab('sellProduct')">銷售產品</button>
  <button onclick="showTab('searchProduct')">條碼查詢</button>
  <button onclick="showTab('inventoryList')">庫存列表</button>
  <button onclick="showTab('orderList')">訂單列表</button>
</nav>

<!-- 新增庫存 -->
<div id="addInventory" class="tab-content" style="display:block;">
  <h2>新增庫存</h2>
  <div class="form-group"><label>品名：<input type="text" id="inv_name"></label></div>
  <div class="form-group"><label>品號：<input type="text" id="inv_code"></label></div>
  <div class="form-group"><label>序號：<input type="text" id="inv_serial"></label></div>
  <div class="form-group"><label>原價：<input type="number" id="inv_price"></label></div>
  <div class="form-group"><label>折扣：<input type="number" id="inv_discount" step="0.01" value="1"></label></div>
  <button onclick="addInventory()">送出</button>
</div>

<!-- 銷售產品 -->
<div id="sellProduct" class="tab-content">
  <h2>銷售產品</h2>
  <div class="form-group"><label>品號：<input type="text" id="sell_code"></label></div>
  <div class="form-group"><label>序號：<input type="text" id="sell_serial"></label></div>
  <div class="form-group"><label>客戶姓名：<input type="text" id="sell_customer"></label></div>
  <div class="form-group"><label>聯絡方式：<input type="text" id="sell_contact"></label></div>
  <div class="form-group"><label>售價：<input type="number" id="sell_price"></label></div>
  <div class="form-group"><label>負責人：<input type="text" id="sell_handler"></label></div>
  <div class="form-group"><label>備註：<input type="text" id="sell_note"></label></div>
  <button onclick="sellProduct()">送出</button>
</div>

<!-- 條碼查詢 -->
<div id="searchProduct" class="tab-content">
  <h2>條碼查詢</h2>
  <div class="form-group"><label>輸入品號或序號：<input type="text" id="search_code"></label></div>
  <button onclick="searchProduct()">查詢</button>
  <div id="searchResults"></div>
</div>

<!-- 庫存列表 -->
<div id="inventoryList" class="tab-content">
  <h2>庫存列表</h2>
  <table>
    <thead>
      <tr>
        <th>進貨時間</th>
        <th>品名</th>
        <th>品號</th>
        <th>序號</th>
        <th>原價</th>
        <th>折扣</th>
        <th>進價</th>
        <th>狀態</th>
      </tr>
    </thead>
    <tbody id="inventoryTable"></tbody>
  </table>
</div>

<!-- 訂單列表 -->
<div id="orderList" class="tab-content">
  <h2>訂單列表</h2>
  <label>選擇月份：<input type="month" id="orderMonth"></label>
  <button onclick="loadOrders()">查詢</button>
  <h3 id="orderTotal"></h3>
  <table>
    <thead>
      <tr>
        <th>銷售時間</th>
        <th>品號</th>
        <th>序號</th>
        <th>客戶姓名</th>
        <th>聯絡方式</th>
        <th>售價</th>
        <th>負責人</th>
        <th>備註</th>
      </tr>
    </thead>
    <tbody id="orderTable"></tbody>
  </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw2zT3Ri55NM0emdlp4GyyGFuKibWyUOVy6nOedjBqz1k_LXtQMU9eN1qqJ4iC6neyB/exec";

// 切換分頁
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.getElementById(tabId).style.display = 'block';
  document.querySelector(`nav button[onclick="showTab('${tabId}')"]`).classList.add('active');

  if (tabId === "inventoryList") loadInventory();
  if (tabId === "orderList") loadOrders();
}

// 新增庫存
function addInventory() {
  const params = new URLSearchParams({
    action: "addInventory",
    name: document.getElementById("inv_name").value,
    code: document.getElementById("inv_code").value,
    serial: document.getElementById("inv_serial").value,
    price: document.getElementById("inv_price").value,
    discount: document.getElementById("inv_discount").value
  });
  fetch(`${API_URL}?${params}`).then(res => res.json()).then(alert);
}

// 銷售產品
function sellProduct() {
  const params = new URLSearchParams({
    action: "sellProduct",
    code: document.getElementById("sell_code").value,
    serial: document.getElementById("sell_serial").value,
    customerName: document.getElementById("sell_customer").value,
    customerContact: document.getElementById("sell_contact").value,
    sellPrice: document.getElementById("sell_price").value,
    handler: document.getElementById("sell_handler").value,
    note: document.getElementById("sell_note").value
  });
  fetch(`${API_URL}?${params}`).then(res => res.json()).then(alert);
}

// 條碼查詢
function searchProduct() {
  const code = document.getElementById("search_code").value;
  fetch(`${API_URL}?action=searchByCode&code=${code}`)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("searchResults");
      container.innerHTML = "";
      if (data.results && data.results.length > 0) {
        data.results.forEach(item => {
          container.innerHTML += `
            <div style="border:1px solid #ccc; padding:10px; margin:5px;">
              <p><b>進貨時間：</b>${item.inventory.stockInDate}</p>
              <p><b>品名：</b>${item.inventory.name}</p>
              <p><b>品號：</b>${item.inventory.productCode}</p>
              <p><b>序號：</b>${item.inventory.serialNumber}</p>
              <p><b>售出時間：</b>${item.order ? item.order.sellTime : '尚未售出'}</p>
            </div>
          `;
        });
      } else {
        container.innerHTML = "<p>查無資料</p>";
      }
    });
}

// 載入庫存
function loadInventory() {
  fetch(`${API_URL}?action=getInventory`)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("inventoryTable");
      tbody.innerHTML = "";
      data.inventories.forEach(item => {
        tbody.innerHTML += `
          <tr>
            <td>${item.stockInDate}</td>
            <td>${item.name}</td>
            <td>${item.productCode}</td>
            <td>${item.serialNumber}</td>
            <td>${item.price}</td>
            <td>${item.discount}</td>
            <td>${item.costPrice}</td>
            <td>${item.status}</td>
          </tr>
        `;
      });
    });
}

// 載入訂單
function loadOrders() {
  const month = document.getElementById("orderMonth").value || new Date().toISOString().slice(0,7);
  fetch(`${API_URL}?action=getOrdersByMonth&month=${month}`)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("orderTable");
      tbody.innerHTML = "";
      data.orders.forEach(order => {
        tbody.innerHTML += `
          <tr>
            <td>${order.sellTime}</td>
            <td>${order.productCode}</td>
            <td>${order.serialNumber}</td>
            <td>${order.customerName}</td>
            <td>${order.customerContact}</td>
            <td>${order.sellPrice}</td>
            <td>${order.handler}</td>
            <td>${order.note}</td>
          </tr>
        `;
      });
      document.getElementById("orderTotal").innerText = `該月份總銷售額：${data.totalSales}`;
    });
}

// 預設設定當月
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("orderMonth").value = new Date().toISOString().slice(0,7);
});
</script>

</body>
</html>
